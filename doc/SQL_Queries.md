SQL Server -> Neo4j
===================


Selecting all of the Tables
---------------------------

    SELECT name
    FROM sys.Tables


Selecting all of the Tables and their Columns
---------------------------------------------

    SELECT TABLE_NAME, COLUMN_NAME
    FROM INFORMATION_SCHEMA.COLUMNS
    ORDER BY TABLE_NAME, ORDINAL_POSITION


Selecting Foreign Key Info
--------------------------

    SELECT C.TABLE_NAME [PKTABLE_NAME], 
           KCU.COLUMN_NAME [PKCOLUMN_NAME],
           C2.TABLE_NAME [FKTABLE_NAME], 
          KCU2.COLUMN_NAME [FKCOLUMN_NAME]
    FROM   INFORMATION_SCHEMA.TABLE_CONSTRAINTS C 
          INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU 
            ON C.CONSTRAINT_SCHEMA = KCU.CONSTRAINT_SCHEMA 
                AND C.CONSTRAINT_NAME = KCU.CONSTRAINT_NAME 
          INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS RC 
            ON C.CONSTRAINT_SCHEMA = RC.CONSTRAINT_SCHEMA 
                AND C.CONSTRAINT_NAME = RC.CONSTRAINT_NAME 
          INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS C2 
            ON RC.UNIQUE_CONSTRAINT_SCHEMA = C2.CONSTRAINT_SCHEMA 
                AND RC.UNIQUE_CONSTRAINT_NAME = C2.CONSTRAINT_NAME 
          INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU2 
            ON C2.CONSTRAINT_SCHEMA = KCU2.CONSTRAINT_SCHEMA 
                AND C2.CONSTRAINT_NAME = KCU2.CONSTRAINT_NAME 
                AND KCU.ORDINAL_POSITION = KCU2.ORDINAL_POSITION 
    WHERE  C.CONSTRAINT_TYPE = 'FOREIGN KEY'


Merging the Two
---------------


    SELECT INFO.TABLE_NAME, INFO.COLUMN_NAME, 
      FK.FKTABLE_NAME, FK.FKCOLUMN_NAME 
    FROM

    (SELECT TABLE_NAME, COLUMN_NAME
        FROM INFORMATION_SCHEMA.COLUMNS) AS INFO
    
    LEFT OUTER JOIN
    
    (SELECT C.TABLE_NAME [TABLE_NAME], 
           KCU.COLUMN_NAME [COLUMN_NAME],
           C2.TABLE_NAME [FKTABLE_NAME], 
          KCU2.COLUMN_NAME [FKCOLUMN_NAME]
    FROM   INFORMATION_SCHEMA.TABLE_CONSTRAINTS C 
          INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU 
            ON C.CONSTRAINT_SCHEMA = KCU.CONSTRAINT_SCHEMA 
                AND C.CONSTRAINT_NAME = KCU.CONSTRAINT_NAME 
          INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS RC 
            ON C.CONSTRAINT_SCHEMA = RC.CONSTRAINT_SCHEMA 
                AND C.CONSTRAINT_NAME = RC.CONSTRAINT_NAME 
          INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS C2 
            ON RC.UNIQUE_CONSTRAINT_SCHEMA = C2.CONSTRAINT_SCHEMA 
                AND RC.UNIQUE_CONSTRAINT_NAME = C2.CONSTRAINT_NAME 
          INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU2 
            ON C2.CONSTRAINT_SCHEMA = KCU2.CONSTRAINT_SCHEMA 
                AND C2.CONSTRAINT_NAME = KCU2.CONSTRAINT_NAME 
                AND KCU.ORDINAL_POSITION = KCU2.ORDINAL_POSITION 
    WHERE  C.CONSTRAINT_TYPE = 'FOREIGN KEY') AS FK

    ON FK.TABLE_NAME = INFO.TABLE_NAME
      AND FK.COLUMN_NAME = INFO.COLUMN_NAME
    ORDER BY INFO.TABLE_NAME, INFO.COLUMN_NAME
